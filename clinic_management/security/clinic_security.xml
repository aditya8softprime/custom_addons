<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Clinic Security Groups -->
        <record id="group_clinic_receptionist" model="res.groups">
            <field name="name">Clinic Receptionist</field>
            <field name="comment">Group for clinic receptionists to manage appointments and patients</field>
            <field name="category_id" ref="base.module_category_services"/>
        </record>

        <record id="group_clinic_nurse" model="res.groups">
            <field name="name">Clinic Nurse</field>
            <field name="comment">Group for nurses to assist with patient care</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_clinic_receptionist'))]"/>
        </record>

        <record id="group_clinic_doctor" model="res.groups">
            <field name="name">Clinic Doctor</field>
            <field name="comment">Group for doctors to manage their appointments and patients</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_clinic_nurse'))]"/>
        </record>

        <record id="group_clinic_manager" model="res.groups">
            <field name="name">Clinic Manager</field>
            <field name="comment">Group for clinic managers to oversee daily operations</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_clinic_receptionist'))]"/>
        </record>

        <record id="group_clinic_admin" model="res.groups">
            <field name="name">Clinic Administrator</field>
            <field name="comment">Group for clinic administrators with full access</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_clinic_manager')), (4, ref('group_clinic_doctor'))]"/>
        </record>

        <!-- Multi-company rule for Doctor -->
        <record id="rule_clinic_doctor_company" model="ir.rule">
            <field name="name">Clinic Doctor: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_doctor"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Multi-company rule for Service -->
        <record id="rule_clinic_service_company" model="ir.rule">
            <field name="name">Clinic Service: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_service"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Multi-company rule for Slot -->
        <record id="rule_clinic_slot_company" model="ir.rule">
            <field name="name">Clinic Slot: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_slot"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('doctor_id.company_id', 'in', company_ids)]</field>
        </record>

        <!-- Multi-company rule for Patient -->
        <record id="rule_clinic_patient_company" model="ir.rule">
            <field name="name">Clinic Patient: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_patient"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Multi-company rule for Appointment -->
        <record id="rule_clinic_appointment_company" model="ir.rule">
            <field name="name">Clinic Appointment: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Doctor can only see their own appointments -->
        <record id="rule_appointment_doctor" model="ir.rule">
            <field name="name">Doctor can only see their own appointments</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="groups" eval="[(4, ref('group_clinic_doctor'))]"/>
            <field name="domain_force">[('doctor_id.user_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Nurse can see appointments from their assigned doctors -->
        <record id="rule_appointment_nurse" model="ir.rule">
            <field name="name">Nurse can see appointments from assigned doctors</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="groups" eval="[(4, ref('group_clinic_nurse'))]"/>
            <field name="domain_force">['|', ('doctor_id.user_id', '=', user.id), ('doctor_id.department', '=', user.employee_id.department_id.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Receptionist can see and schedule all appointments -->
        <record id="rule_appointment_receptionist" model="ir.rule">
            <field name="name">Receptionist can see and schedule all appointments</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="groups" eval="[(4, ref('group_clinic_receptionist'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Clinic Manager can manage all appointments -->
        <record id="rule_appointment_manager" model="ir.rule">
            <field name="name">Clinic Manager can manage all appointments</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="groups" eval="[(4, ref('group_clinic_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>
        
        <!-- Base admin user access -->
        <record id="rule_appointment_base_admin" model="ir.rule">
            <field name="name">Base admin can access all appointments</field>
            <field name="model_id" ref="model_clinic_appointment"/>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- Doctor can only modify their own holiday/leave records -->
        <record id="rule_holiday_doctor" model="ir.rule">
            <field name="name">Doctor can only modify their own holiday records</field>
            <field name="model_id" ref="model_clinic_holiday"/>
            <field name="groups" eval="[(4, ref('group_clinic_doctor'))]"/>
            <field name="domain_force">[('doctor_id.user_id', '=', user.id)]</field>
        </record>
        
        <!-- Manager can modify all holiday/leave records -->
        <record id="rule_holiday_manager" model="ir.rule">
            <field name="name">Manager can modify all holiday records</field>
            <field name="model_id" ref="model_clinic_holiday"/>
            <field name="groups" eval="[(4, ref('group_clinic_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- Multi-company rule for Prescription -->
        <record id="rule_clinic_prescription_company" model="ir.rule">
            <field name="name">Clinic Prescription: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_prescription"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('doctor_id.company_id', 'in', company_ids)]</field>
        </record>

        <!-- Doctor can only see and modify their own prescriptions -->
        <!-- <record id="rule_prescription_doctor" model="ir.rule">
            <field name="name">Doctor can only see their own prescriptions</field>
            <field name="model_id" ref="model_clinic_prescription"/>
            <field name="groups" eval="[(4, ref('group_clinic_doctor'))]"/>
            <field name="domain_force">[('doctor_id.user_id', '=', user.id)]</field>
            <field name="perm_create" eval="True"/>
        </record> -->

        <!-- Multi-company rule for Prescription Medication -->
        <record id="rule_clinic_prescription_medication_company" model="ir.rule">
            <field name="name">Clinic Prescription Medication: Multi-company Rule</field>
            <field name="model_id" ref="model_clinic_prescription_medication"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[('prescription_id.doctor_id.company_id', 'in', company_ids)]</field>
        </record>

        <!-- Doctor can only see and modify their own prescription medications -->
        <record id="rule_prescription_medication_doctor" model="ir.rule">
            <field name="name">Doctor can only see their own prescription medications</field>
            <field name="model_id" ref="model_clinic_prescription_medication"/>
            <field name="groups" eval="[(4, ref('group_clinic_doctor'))]"/>
            <field name="domain_force">[('prescription_id.doctor_id.user_id', '=', user.id)]</field>
        </record>

        <!-- Base admin user access for prescription medication -->
        <record id="rule_prescription_medication_base_admin" model="ir.rule">
            <field name="name">Base admin can access all prescription medications</field>
            <field name="model_id" ref="model_clinic_prescription_medication"/>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- Patient record access rules -->
        <!-- <record id="rule_patient_doctor" model="ir.rule">
            <field name="name">Doctor can see patients they've treated</field>
            <field name="model_id" ref="model_clinic_patient"/>
            <field name="groups" eval="[(4, ref('group_clinic_doctor'))]"/>
            <field name="domain_force">['|', ('appointment_ids.doctor_id.user_id', '=', user.id), ('prescription_ids.doctor_id.user_id', '=', user.id)]</field>
            <field name="perm_create=True" eval="True"/>
        </record> -->

    </data>
</odoo>
