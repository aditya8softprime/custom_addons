<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Email Template for Prescription -->
        <record id="email_template_prescription" model="mail.template">
            <field name="name">Prescription Notification</field>
            <field name="model_id" ref="model_clinic_prescription"/>
            <field name="subject">Your Prescription from {{object.doctor_id.name}} - {{object.name}}</field>
            <field name="email_from">{{(object.company_id.email or user.email)|safe}}</field>
            <field name="email_to">{{object.patient_id.email}}</field>
            <field name="auto_delete" eval="True"/>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <div style="margin: 0px; padding: 0px; font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFFFFF;">
                        <table cellpadding="0" cellspacing="0" style="width: 100%; margin: 0px auto; background-color: white;">
                            <tbody>
                                <tr>
                                    <td style="width: 100%;">
                                        <div style="padding: 20px; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6;">
                                            <h2 style="margin: 0; color: #007bff;">
                                                <strong>{{object.company_id.name or 'Clinic'}}</strong>
                                            </h2>
                                            <p style="margin: 5px 0 0 0; color: #6c757d;">Your Prescription Details</p>
                                        </div>

                                        <div style="padding: 20px;">
                                            <h3 style="color: #495057;">Dear {{object.patient_id.name}},</h3>

                                            <p>Your prescription has been prepared by <strong>Dr. {{object.doctor_id.name}}</strong>. Please find the details below:</p>

                                            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0;">
                                                <h4 style="margin-top: 0; color: #007bff;">Prescription Details</h4>
                                                <p><strong>Prescription Number:</strong> {{object.name}}</p>
                                                <p><strong>Date:</strong> {{object.prescription_date}}</p>
                                                <p><strong>Doctor:</strong> Dr. {{object.doctor_id.name}}</p>
                                                % if object.appointment_id:
                                                <p><strong>Appointment:</strong> {{object.appointment_id.name}} - {{object.appointment_id.appointment_date}}</p>
                                                % endif
                                            </div>

                                            % if object.medication_ids:
                                            <h4 style="color: #007bff;">Prescribed Medications:</h4>
                                            <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                                                <thead>
                                                    <tr style="background-color: #007bff; color: white;">
                                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Medicine</th>
                                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Dosage</th>
                                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Frequency</th>
                                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Duration</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    % for medication in object.medication_ids:
                                                    <tr>
                                                        <td style="padding: 8px; border: 1px solid #dee2e6;">{{medication.medicine_name}}</td>
                                                        <td style="padding: 8px; border: 1px solid #dee2e6;">{{medication.dosage or '-'}}</td>
                                                        <td style="padding: 8px; border: 1px solid #dee2e6;">{{medication.frequency or '-'}}</td>
                                                        <td style="padding: 8px; border: 1px solid #dee2e6;">{{medication.duration or '-'}}</td>
                                                    </tr>
                                                    % endfor
                                                </tbody>
                                            </table>
                                            % endif

                                            % if object.notes:
                                            <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #ffc107;">
                                                <h4 style="margin-top: 0; color: #856404;">Doctor's Notes:</h4>
                                                <p style="margin-bottom: 0;">{{object.notes}}</p>
                                            </div>
                                            % endif

                                            <div style="background-color: #d1ecf1; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #17a2b8;">
                                                <h4 style="margin-top: 0; color: #0c5460;">Important Instructions:</h4>
                                                <ul style="margin-bottom: 0;">
                                                    <li>Take medications as prescribed by your doctor</li>
                                                    <li>Complete the full course even if you feel better</li>
                                                    <li>Contact us if you experience any adverse effects</li>
                                                    <li>Keep this prescription for your records</li>
                                                </ul>
                                            </div>

                                            <p>If you have any questions about your prescription, please don't hesitate to contact us.</p>

                                            <p>
                                                Best regards,<br/>
                                                <strong>{{object.company_id.name or 'Clinic Management Team'}}</strong>
                                            </p>
                                        </div>

                                        <div style="padding: 20px; background-color: #f8f9fa; border-top: 1px solid #dee2e6; text-align: center;">
                                            <p style="margin: 0; color: #6c757d; font-size: 11px;">
                                                This is an automated message. Please do not reply to this email.
                                            </p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </field>
        </record>
    </data>
</odoo>
