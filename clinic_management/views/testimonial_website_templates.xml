<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Testimonials Website Page -->
    <template id="testimonials_page" name="Patient Testimonials">
        <t t-call="website.layout">
            <div class="container mt-4">
                <h1 class="text-center mb-5">What Our Patients Say</h1>
                
                <div class="row">
                    <t t-foreach="testimonials" t-as="testimonial">
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <img t-if="testimonial.image" t-att-src="'data:image/png;base64,%s' % to_text(testimonial.image)" 
                                             class="rounded-circle mr-3" alt="Patient" width="60" height="60"/>
                                        <img t-else="" src="/web/static/src/img/placeholder.png" 
                                             class="rounded-circle mr-3" alt="Patient" width="60" height="60"/>
                                        <div>
                                            <h5 class="mb-0"><t t-esc="testimonial.name"/></h5>
                                            <div class="text-warning">
                                                <t t-set="rating" t-value="int(testimonial.rating or '5')"/>
                                                <t t-foreach="range(5)" t-as="star">
                                                    <i t-if="star &lt; rating" class="fa fa-star"></i>
                                                    <i t-else="" class="fa fa-star-o"></i>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="card-text font-italic">
                                        <i class="fa fa-quote-left text-muted mr-2"></i>
                                        <t t-esc="testimonial.comment"/>
                                        <i class="fa fa-quote-right text-muted ml-2"></i>
                                    </p>
                                    <div class="text-muted mt-3">
                                        <small>
                                            <t t-if="testimonial.service_id">
                                                <span class="badge badge-light">
                                                    <i class="fa fa-tag mr-1"></i> <t t-esc="testimonial.service_id.name"/>
                                                </span>
                                            </t>
                                            <t t-if="testimonial.doctor_id">
                                                <span class="badge badge-light ml-2">
                                                    <i class="fa fa-user-md mr-1"></i> Dr. <t t-esc="testimonial.doctor_id.name"/>
                                                </span>
                                            </t>
                                        </small>
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small><t t-esc="testimonial.date"/></small>
                                </div>
                            </div>
                        </div>
                    </t>
                    
                    <div t-if="not testimonials" class="col-12 text-center py-5">
                        <div class="alert alert-info">
                            <p><i class="fa fa-info-circle mr-2"></i> No testimonials available at the moment.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Testimonial Button -->
                <div class="text-center mt-4 mb-5">
                    <a href="/clinic/testimonial/submit" class="btn btn-primary">Share Your Experience</a>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Testimonial Submission Form -->
    <template id="testimonial_submission_form" name="Submit Testimonial">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-lg-8 offset-lg-2">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h2 class="mb-0">Share Your Experience</h2>
                            </div>
                            <div class="card-body">
                                <form action="/clinic/testimonial/submit" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="form-group">
                                        <label for="name">Your Name</label>
                                        <input type="text" class="form-control" id="name" name="name" required="required"/>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="rating">Rating</label>
                                        <div class="rating-stars">
                                            <t t-foreach="range(1,6)" t-as="star">
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="rating" 
                                                           t-att-id="'star' + str(star)" t-att-value="str(star)" 
                                                           t-att-checked="star == 5"/>
                                                    <label class="form-check-label" t-att-for="'star' + str(star)">
                                                        <i class="fa fa-star text-warning"></i>
                                                    </label>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="doctor_id">Doctor (Optional)</label>
                                            <select class="form-control" id="doctor_id" name="doctor_id">
                                                <option value="">Select Doctor</option>
                                                <t t-foreach="doctors" t-as="doctor">
                                                    <option t-att-value="doctor.id">Dr. <t t-esc="doctor.name"/></option>
                                                </t>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="service_id">Service (Optional)</label>
                                            <select class="form-control" id="service_id" name="service_id">
                                                <option value="">Select Service</option>
                                                <t t-foreach="services" t-as="service">
                                                    <option t-att-value="service.id"><t t-esc="service.name"/></option>
                                                </t>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="image">Your Photo (Optional)</label>
                                        <input type="file" class="form-control-file" id="image" name="image" accept="image/*"/>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="comment">Your Testimonial</label>
                                        <textarea class="form-control" id="comment" name="comment" rows="5" required="required"></textarea>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Submit Testimonial</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Testimonial Submission Confirmation -->
    <template id="testimonial_thank_you" name="Testimonial Thank You">
        <t t-call="website.layout">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-lg-8 offset-lg-2">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h2 class="mb-0">Thank You!</h2>
                            </div>
                            <div class="card-body text-center">
                                <div class="py-5">
                                    <i class="fa fa-check-circle text-success" style="font-size: 64px;"></i>
                                    <h3 class="mt-4">Your testimonial has been submitted successfully.</h3>
                                    <p class="lead">We appreciate you taking the time to share your experience.</p>
                                    <p>Your feedback helps us improve our services and helps other patients make informed decisions.</p>
                                </div>
                                <div class="mt-4">
                                    <a href="/clinic" class="btn btn-primary">Return to Clinic Homepage</a>
                                    <a href="/clinic/testimonials" class="btn btn-outline-primary ml-2">View All Testimonials</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Add testimonials section to homepage -->
    <template id="testimonials_snippet" name="Testimonials Snippet">
        <section class="bg-light py-5 mt-5">
            <div class="container">
                <h2 class="text-center mb-5">What Our Patients Say</h2>
                
                <div class="row">
                    <t t-if="testimonials">
                        <t t-foreach="testimonials[:3]" t-as="testimonial">
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <img t-if="testimonial.image" t-att-src="'data:image/png;base64,%s' % to_text(testimonial.image)" 
                                                 class="rounded-circle mr-3" alt="Patient" width="50" height="50"/>
                                            <img t-else="" src="/web/static/src/img/placeholder.png" 
                                                 class="rounded-circle mr-3" alt="Patient" width="50" height="50"/>
                                            <div>
                                                <h5 class="mb-0"><t t-esc="testimonial.name"/></h5>
                                                <div class="text-warning">
                                                    <t t-set="rating" t-value="int(testimonial.rating or '5')"/>
                                                    <t t-foreach="range(5)" t-as="star">
                                                        <i t-if="star &lt; rating" class="fa fa-star"></i>
                                                        <i t-else="" class="fa fa-star-o"></i>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="card-text font-italic">
                                            <i class="fa fa-quote-left text-muted mr-2"></i>
                                            <t t-esc="testimonial.comment"/>
                                            <i class="fa fa-quote-right text-muted ml-2"></i>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </t>
                    <t t-else="">
                        <div class="col-12 text-center">
                            <div class="alert alert-info">
                                <p>No testimonials available yet. Be the first to share your experience!</p>
                            </div>
                        </div>
                    </t>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/clinic/testimonials" class="btn btn-outline-primary">View All Testimonials</a>
                    <a href="/clinic/testimonial/submit" class="btn btn-primary ml-2">Share Your Experience</a>
                </div>
            </div>
        </section>
    </template>
</odoo>
